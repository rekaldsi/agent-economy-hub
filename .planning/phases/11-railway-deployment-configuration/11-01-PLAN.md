# Phase 11 Plan 1: Railway Deployment Configuration

<objective>
Prepare the Agent Economy Hub for production deployment on Railway by updating environment configuration, creating deployment documentation, and ensuring all health checks are properly configured. This phase provides everything needed for a smooth production launch.
</objective>

<execution_context>
## What We're Building

**Core Feature**: Production deployment configuration and documentation

**Current State** (from Phase 10):
- ‚úÖ Railway.json exists with proper configuration
- ‚úÖ Health check endpoint (/health) tests DB connection
- ‚úÖ Restart policy configured (ON_FAILURE, max 3 retries)
- ‚úÖ Start command correct (node src/index.js)
- ‚úÖ Environment validation in src/index.js (from Phase 9)
- ‚úÖ Graceful shutdown handlers (from Phase 9)
- ‚úÖ Database seeding script ready (npm run seed)
- ‚ùå .env.example incomplete (missing DATABASE_URL, ALCHEMY_API_KEY)
- ‚ùå NO Railway deployment documentation
- ‚ùå README.md outdated (references old endpoints, OpenServ)
- ‚ùå NO production deployment checklist

**Current railway.json**:
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "node src/index.js",
    "healthcheckPath": "/health",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  }
}
```
- Builder: NIXPACKS (automatic Node.js detection)
- Health check: /health endpoint (returns 200 when healthy, 503 when DB fails)
- Restart policy: Restart on failure, max 3 retries

**Current .env.example** (incomplete):
```
PORT=7378
WALLET_ADDRESS=0xA193...
ANTHROPIC_API_KEY=
REPLICATE_API_TOKEN=
```
Missing: DATABASE_URL, ALCHEMY_API_KEY, NODE_ENV, LOG_LEVEL

**Why This Matters**:
- Without proper documentation, deployment will be error-prone
- Missing environment variables cause startup failures
- Production team needs clear deployment instructions
- Health checks ensure Railway can monitor app status

**Target State**:
- Complete .env.example with all required and optional variables
- Comprehensive Railway deployment guide (docs/RAILWAY.md)
- Updated README.md reflecting current functionality
- Production readiness checklist
- Clear instructions for Railway dashboard configuration
</execution_context>

<context>
## Project Context

**Required Environment Variables** (from src/index.js Phase 9 validation):
1. **DATABASE_URL** - PostgreSQL connection string
2. **ANTHROPIC_API_KEY** - Claude AI API key (starts with sk-ant-)
3. **ALCHEMY_API_KEY** - Blockchain RPC for Base network
4. **REPLICATE_API_TOKEN** - Image generation API (starts with r8_)

**Optional Environment Variables**:
- **PORT** - Server port (default: 7378)
- **NODE_ENV** - Environment (production/development)
- **LOG_LEVEL** - Winston log level (error/warn/info/debug)

**Railway Platform**:
- Automatic Nixpacks detection for Node.js
- PostgreSQL add-on available (sets DATABASE_URL automatically)
- Health checks monitor /health endpoint
- Restart policy handles crashes
- Environment variables set via dashboard
- Supports custom domains
- Free tier: $5 credit/month, paid plans available

**Health Check Endpoint** (from Phase 9):
- GET /health
- Tests database connection with SELECT 1
- Returns 200 with JSON when healthy
- Returns 503 when database fails
- Includes uptime, version, services count
- Railway polls this endpoint to determine app health

**Deployment Process**:
1. Create Railway project
2. Connect GitHub repository
3. Add PostgreSQL database
4. Set environment variables
5. Deploy (automatic from main branch)
6. Run seed script (npm run seed)
7. Verify health check
8. Configure custom domain (optional)

## Recent Work (Phases 1-10)

**Phase 10**: Database Seeding & Initial Data
- Created npm run seed script
- Idempotent seeding (safe to run in production)
- Seeds MrMagoochi agent and 22 skills

**Phase 9**: Rate Limiting & Basic Ops
- Health check endpoint with DB testing
- Graceful shutdown handlers
- Structured logging with Winston
- Environment variable validation

**Phase 8**: Mobile Responsive & UI Polish
- Production-ready UI
- Mobile-friendly design
- Toast notifications

**Unblocked By Phase 10**:
- Database seeding script ready for Railway
- Can run npm run seed after deployment
- Initial data available for testing
</context>

---

## Tasks

## Task 1: Update .env.example with Complete Configuration

**Goal**: Document all required and optional environment variables with descriptions

**What to do**:

1. **Replace .env.example** with complete configuration:
   ```env
   # ==============================================
   # Agent Economy Hub - Environment Configuration
   # ==============================================

   # ----------------
   # Server
   # ----------------
   PORT=7378
   NODE_ENV=development
   # Options: development, production

   # ----------------
   # Database
   # ----------------
   DATABASE_URL=postgresql://user:password@host:port/database
   # PostgreSQL connection string
   # Railway: Automatically set when PostgreSQL add-on is attached
   # Format: postgresql://user:pass@host:5432/dbname?sslmode=require

   # ----------------
   # AI Services
   # ----------------
   ANTHROPIC_API_KEY=
   # Anthropic API key for Claude AI text generation
   # Get from: https://console.anthropic.com/
   # Format: Starts with sk-ant-
   # Required for: All text-based services (brainstorm, research, write, etc.)

   REPLICATE_API_TOKEN=
   # Replicate API token for image generation
   # Get from: https://replicate.com/account/api-tokens
   # Format: Starts with r8_
   # Required for: All visual services (image_generate, image_portrait, etc.)

   # ----------------
   # Blockchain
   # ----------------
   ALCHEMY_API_KEY=
   # Alchemy API key for Base network RPC
   # Get from: https://alchemy.com/ (create app on Base network)
   # Required for: Payment verification, on-chain transaction checks

   # ----------------
   # Logging (Optional)
   # ----------------
   LOG_LEVEL=info
   # Winston log level: error, warn, info, debug
   # Production: info or warn
   # Development: debug

   # ==============================================
   # Production-Only Variables (set in Railway)
   # ==============================================
   # These are automatically set by Railway or should be set via dashboard:
   # - DATABASE_URL (set by PostgreSQL add-on)
   # - PORT (Railway sets this automatically)
   # - NODE_ENV=production (set manually in Railway)

   # ==============================================
   # Development Notes
   # ==============================================
   # 1. Copy this file to .env: cp .env.example .env
   # 2. Fill in your API keys
   # 3. DATABASE_URL: Use local PostgreSQL or Railway dev DB
   # 4. Never commit .env to git (already in .gitignore)
   ```

2. **Verify .gitignore includes .env**:
   ```bash
   grep -q "^\.env$" .gitignore || echo ".env" >> .gitignore
   ```

**Files Modified**:
- `.env.example` (updated with complete configuration)
- `.gitignore` (verify .env is excluded)

**Verification**:
- All 4 required variables documented (DATABASE_URL, ANTHROPIC_API_KEY, ALCHEMY_API_KEY, REPLICATE_API_TOKEN)
- All optional variables documented (PORT, NODE_ENV, LOG_LEVEL)
- Clear descriptions and links for obtaining API keys
- Production notes included

**Commit Message**:
```
docs(11-01): update .env.example with complete environment configuration
```

---

## Task 2: Create Railway Deployment Guide

**Goal**: Create comprehensive step-by-step deployment documentation

**What to do**:

1. **Create docs/RAILWAY.md**:
   ```markdown
   # Railway Deployment Guide

   Complete guide for deploying Agent Economy Hub to Railway.

   ## Prerequisites

   - Railway account (https://railway.app/)
   - GitHub repository access
   - API keys ready:
     - Anthropic API key (https://console.anthropic.com/)
     - Replicate API token (https://replicate.com/account/api-tokens)
     - Alchemy API key (https://alchemy.com/, Base network)

   ---

   ## Step 1: Create Railway Project

   1. Log in to Railway: https://railway.app/
   2. Click **"New Project"**
   3. Select **"Deploy from GitHub repo"**
   4. Authorize Railway to access your GitHub account
   5. Select the **agent-economy-hub** repository
   6. Railway will detect the Node.js project and start building

   **What Railway Does Automatically**:
   - Detects Node.js via package.json
   - Uses Nixpacks builder
   - Installs dependencies (npm install)
   - Reads railway.json for configuration
   - Sets up health check monitoring

   ---

   ## Step 2: Add PostgreSQL Database

   1. In your Railway project dashboard, click **"New"**
   2. Select **"Database"** ‚Üí **"PostgreSQL"**
   3. Railway provisions a PostgreSQL instance
   4. **DATABASE_URL** environment variable is automatically set

   **What You Get**:
   - Managed PostgreSQL database
   - Automatic backups
   - DATABASE_URL with connection string
   - SSL enabled by default

   ---

   ## Step 3: Configure Environment Variables

   In Railway project ‚Üí **Variables** tab, add:

   ### Required Variables

   | Variable | Value | Where to Get |
   |----------|-------|--------------|
   | `ANTHROPIC_API_KEY` | sk-ant-... | https://console.anthropic.com/ |
   | `ALCHEMY_API_KEY` | your-key | https://alchemy.com/ (Base network app) |
   | `REPLICATE_API_TOKEN` | r8_... | https://replicate.com/account/api-tokens |
   | `NODE_ENV` | production | Manual: Type "production" |
   | `LOG_LEVEL` | info | Manual: Type "info" (optional, defaults to info) |

   ### Auto-Set Variables (Do Not Set Manually)

   | Variable | Source |
   |----------|--------|
   | `DATABASE_URL` | Set by PostgreSQL add-on |
   | `PORT` | Set by Railway automatically |

   **How to Add Variables**:
   1. Click **"New Variable"**
   2. Enter variable name (e.g., ANTHROPIC_API_KEY)
   3. Enter value
   4. Click **"Add"**
   5. Repeat for all required variables

   **After adding variables**, Railway will automatically redeploy.

   ---

   ## Step 4: Verify Deployment

   1. Wait for deployment to complete (watch logs in Railway dashboard)
   2. Railway provides a URL: `https://your-app.up.railway.app`
   3. Check health endpoint:
      ```bash
      curl https://your-app.up.railway.app/health
      ```

   **Expected Response** (200 OK):
   ```json
   {
     "status": "healthy",
     "uptime": "0h 2m 15s",
     "agent": "MrMagoochi",
     "version": "0.9.0",
     "ai": "claude-sonnet-4",
     "services": 22,
     "database": "connected",
     "timestamp": "2026-02-03T22:00:00.000Z"
   }
   ```

   **If health check fails** (503):
   - Check Railway logs: **Deployments** ‚Üí **View Logs**
   - Common issues:
     - DATABASE_URL not set (add PostgreSQL add-on)
     - Missing API keys (check Variables tab)
     - Build failed (check build logs)

   ---

   ## Step 5: Seed Database

   After successful deployment, seed the database with initial data:

   ### Option 1: Railway CLI (Recommended)

   ```bash
   # Install Railway CLI
   npm install -g @railway/cli

   # Login
   railway login

   # Link to your project
   railway link

   # Run seed command
   railway run npm run seed
   ```

   ### Option 2: One-Time Service

   1. In Railway project, click **"New"** ‚Üí **"Empty Service"**
   2. Name it "Database Seed" (temporary)
   3. Link the same GitHub repo
   4. In Variables, use **Reference Variables** to copy all vars from main service
   5. In Settings ‚Üí **Deploy**, set **Start Command**: `npm run seed`
   6. Deploy runs once, seeds database, then you can delete this service

   **Verify Seeding**:
   ```bash
   # Check logs for:
   # "MrMagoochi user created" (or "already exists")
   # "MrMagoochi agent created" (or "already exists")
   # "Skills seeding complete: created: 22" (or "skipped: 22")
   ```

   ---

   ## Step 6: Configure Custom Domain (Optional)

   1. In Railway project ‚Üí **Settings** ‚Üí **Domains**
   2. Click **"Add Custom Domain"**
   3. Enter your domain (e.g., hub.yourdomain.com)
   4. Add CNAME record to your DNS:
      - Host: hub
      - Value: (Railway provides this, e.g., your-app.up.railway.app)
      - TTL: 3600
   5. Wait for DNS propagation (5-30 minutes)
   6. Railway automatically provisions SSL certificate

   **Your app will be available at**: https://hub.yourdomain.com

   ---

   ## Step 7: Monitor and Maintain

   ### Health Check Monitoring

   Railway automatically monitors `/health` endpoint every 60 seconds:
   - **Healthy**: Returns 200, app stays running
   - **Unhealthy**: Returns 503 or timeout, Railway restarts app (max 3 retries)

   ### View Logs

   ```bash
   # Railway CLI
   railway logs

   # Or via dashboard: Deployments ‚Üí View Logs
   ```

   **Log Levels**:
   - **error**: Application errors, failures
   - **warn**: Rate limit hits, validation errors
   - **info**: Requests, startup messages (default)
   - **debug**: Detailed debugging (not recommended for production)

   ### Restart App

   ```bash
   # Railway CLI
   railway restart

   # Or via dashboard: Deployments ‚Üí Restart
   ```

   ---

   ## Troubleshooting

   ### Deployment Fails

   **Issue**: Build fails with "Cannot find module"
   - **Solution**: Check package.json, ensure all dependencies listed
   - **Command**: `npm install` locally to verify

   **Issue**: Database connection fails
   - **Solution**: Verify PostgreSQL add-on is attached
   - **Check**: Variables tab should show DATABASE_URL

   ### App Crashes After Deployment

   **Issue**: "Missing required environment variables"
   - **Solution**: Check Variables tab, ensure all 4 required vars set
   - **Log**: Railway logs will show which variable is missing

   **Issue**: "Database initialization failed"
   - **Solution**: Check DATABASE_URL format
   - **Expected**: postgresql://user:pass@host:5432/db?sslmode=require

   ### Health Check Fails

   **Issue**: Railway shows "Unhealthy" status
   - **Solution**: Check `/health` endpoint manually
   - **Command**: `curl https://your-app.up.railway.app/health`
   - **Common causes**:
     - Database not connected (check PostgreSQL add-on)
     - App crashed (check logs)
     - Wrong health check path (should be /health)

   ### Rate Limit Issues

   **Issue**: "Too many requests" errors
   - **Solution**: Rate limits are working correctly
   - **Current limits**:
     - Payment: 5 req/min per IP
     - Job creation: 10 req/min per IP
     - See Phase 9 documentation for full list

   ---

   ## Production Checklist

   Before going live, verify:

   - [ ] PostgreSQL database attached
   - [ ] All 4 required environment variables set
   - [ ] NODE_ENV=production
   - [ ] Health check returns 200 OK
   - [ ] Database seeded (npm run seed)
   - [ ] Custom domain configured (optional)
   - [ ] SSL certificate active (automatic)
   - [ ] Logs show no errors
   - [ ] Test payment flow end-to-end
   - [ ] Test AI generation (text and images)
   - [ ] Verify rate limiting works

   ---

   ## Scaling and Performance

   ### Horizontal Scaling

   Railway supports multiple instances:
   1. **Settings** ‚Üí **Instances**
   2. Set replica count (2-10 instances)
   3. Railway load balances automatically

   **Note**: With multiple instances, ensure:
   - Database can handle concurrent connections
   - Stateless app design (already implemented)

   ### Database Scaling

   PostgreSQL add-on scales automatically, but for high traffic:
   - Monitor connection pool usage (logs)
   - Consider upgrading Railway plan
   - Enable connection pooling (already implemented via pg.Pool)

   ### Cost Estimation

   **Free Tier** ($5 credit/month):
   - Small apps, development, testing
   - ~500 hours of compute/month

   **Pro Plan** ($20/month + usage):
   - Production apps
   - Unlimited projects
   - Priority support

   ---

   ## Security Best Practices

   - ‚úÖ Never commit .env to git (already in .gitignore)
   - ‚úÖ Use environment variables for all secrets
   - ‚úÖ Enable SSL (automatic on Railway)
   - ‚úÖ Rate limiting enabled (Phase 9)
   - ‚úÖ Input validation enabled (Phase 7)
   - ‚úÖ SQL injection protection (parameterized queries)
   - ‚úÖ XSS prevention (HTML escaping, CSP headers)

   ---

   ## Support and Resources

   - **Railway Docs**: https://docs.railway.app/
   - **Railway Discord**: https://discord.gg/railway
   - **Project Repo**: https://github.com/your-org/agent-economy-hub
   - **Health Check**: https://your-app.up.railway.app/health
   - **API Stats**: https://your-app.up.railway.app/api/stats

   ---

   *Last updated: 2026-02-03 for Railway deployment*
   ```

2. **Create docs/ directory if it doesn't exist**:
   ```bash
   mkdir -p docs
   ```

**Files Modified**:
- `docs/RAILWAY.md` (created - comprehensive deployment guide)

**Verification**:
- All 7 deployment steps documented
- Troubleshooting section included
- Production checklist provided
- Security best practices listed

**Commit Message**:
```
docs(11-01): create comprehensive Railway deployment guide
```

---

## Task 3: Update README.md with Current Functionality

**Goal**: Update README to reflect Agent Economy Hub (not just MrMagoochi service)

**What to do**:

1. **Replace README.md** with updated content:
   ```markdown
   # Agent Economy Hub

   **Crypto-native AI agent marketplace** where users pay USDC ‚Üí receive AI-generated results

   ## Overview

   Agent Economy Hub is a decentralized marketplace for AI agent services:
   - **Crypto Payments**: USDC on Base network
   - **22 Services**: Text generation, research, image creation
   - **Instant Results**: AI processes jobs immediately after payment
   - **Open Platform**: Any agent can register and offer services

   ## Features

   ‚úÖ **End-to-End Payment Flow**: Verify USDC transactions on-chain
   ‚úÖ **AI Integration**: Claude (text) + Replicate (images)
   ‚úÖ **Agent Webhooks**: External agents can process jobs via webhooks
   ‚úÖ **Mobile Responsive**: Works on all devices
   ‚úÖ **Rate Limiting**: Prevent API abuse and cost overruns
   ‚úÖ **Structured Logging**: Production-ready observability

   ## Services

   ### Creative (5 services)
   - **Brainstorm** ($0.10) - 5 creative ideas for any topic
   - **Creative Concept** ($0.50) - Full campaign concept
   - **Copywriting** ($0.15) - Sharp copy with alternatives
   - **Creative Brief** ($1.00) - Complete strategy document
   - **Social Media Strategy** ($0.50) - Platform-native content strategy

   ### Research (5 services)
   - **Research Report** ($0.50) - Deep research with findings
   - **Competitive Analysis** ($0.75) - SWOT analysis and opportunities
   - **Trend Analysis** ($0.40) - Emerging market trends
   - **Sentiment Analysis** ($0.35) - Brand sentiment breakdown
   - **Data Analysis** ($0.50) - Find patterns and insights

   ### Technical (3 services)
   - **Code Security Review** ($1.00) - Vulnerability detection
   - **API Integration Help** ($0.75) - Integration guidance with examples
   - **Web Data Extraction** ($0.40) - Structured data extraction

   ### Documents (3 services)
   - **Summarize** ($0.25) - Key takeaways from any content
   - **Document Generator** ($0.50) - Formatted documents and briefs
   - **Report Generator** ($0.75) - Professional reports with data

   ### Productivity (1 service)
   - **Email Triage** ($0.30) - Prioritize emails and extract actions

   ### Visual (5 services)
   - **Image Generation** ($0.50) - High-quality images from descriptions
   - **Portrait Generation** ($0.75) - Realistic portraits and headshots
   - **Logo Design** ($1.00) - Logo concepts and brand marks
   - **Product Mockup** ($0.60) - Product photography
   - **Artistic Style** ($0.55) - Images with specific artistic styles

   **Total: 22 services across 6 categories**

   ## Tech Stack

   - **Runtime**: Node.js 18+ / Express 4.18
   - **Database**: PostgreSQL (Railway managed)
   - **AI**: Anthropic Claude Sonnet 4 (text), Replicate (images)
   - **Blockchain**: Ethers.js + Alchemy (Base network)
   - **Deployment**: Railway
   - **Logging**: Winston (structured JSON)

   ## Quick Start

   ### Development Setup

   ```bash
   # Install dependencies
   npm install

   # Copy environment template
   cp .env.example .env

   # Add your API keys to .env:
   # - ANTHROPIC_API_KEY (from https://console.anthropic.com/)
   # - ALCHEMY_API_KEY (from https://alchemy.com/, Base network)
   # - REPLICATE_API_TOKEN (from https://replicate.com/account/api-tokens)
   # - DATABASE_URL (local PostgreSQL or Railway)

   # Start development server
   npm run dev

   # Seed database with initial data
   npm run seed
   ```

   Server runs on http://localhost:7378

   ### Production Deployment

   See [Railway Deployment Guide](docs/RAILWAY.md) for complete instructions.

   **Quick Deploy**:
   1. Create Railway project from GitHub repo
   2. Add PostgreSQL database
   3. Set environment variables (see .env.example)
   4. Deploy automatically on push to main
   5. Run `npm run seed` to populate initial data

   ## API Endpoints

   ### Web Pages (HTML)
   - `GET /` - Landing page with service selection
   - `GET /agents` - Browse all agents
   - `GET /agent/:id` - Agent profile with skills
   - `GET /dashboard` - User dashboard (jobs history)
   - `GET /job/:uuid` - Job details and results
   - `GET /register` - Agent registration form

   ### API (JSON)
   - `POST /api/jobs` - Create new job
   - `POST /api/jobs/:uuid/pay` - Verify payment and trigger AI
   - `GET /api/jobs/:uuid` - Get job status
   - `POST /api/jobs/:uuid/complete` - Agent posts results (webhook)
   - `GET /api/agents` - List all agents
   - `POST /api/register-agent` - Register new agent
   - `GET /api/services` - List all available services

   ### Monitoring
   - `GET /health` - Health check (200 = healthy, 503 = unhealthy)
   - `GET /ready` - Readiness check (tests DB connection)
   - `GET /api/stats` - System metrics and request counts

   ## Architecture

   ### Payment Flow
   1. User creates job (selects agent + skill + input)
   2. User sends USDC to hub wallet on Base network
   3. Hub verifies transaction on-chain (Alchemy + Ethers.js)
   4. Hub triggers AI generation immediately
   5. Results stored in database, displayed to user

   ### Agent Integration
   - **Hub Processing**: MrMagoochi processes jobs directly (webhook_url: null)
   - **External Agents**: Register with webhook_url, receive job notifications, post results

   ### Database Schema
   - **users** - Humans and agents
   - **agents** - Agent profiles with webhook URLs and API keys
   - **skills** - Services offered by agents
   - **jobs** - Service requests with payment and results
   - **webhook_deliveries** - Webhook delivery log

   ## Security

   ‚úÖ **Payment Verification**: On-chain transaction verification (0.1% tolerance)
   ‚úÖ **Rate Limiting**: Tiered limits (5-200 req/min based on endpoint)
   ‚úÖ **Input Validation**: Zod schemas on all API endpoints
   ‚úÖ **SQL Injection Protection**: Parameterized queries throughout
   ‚úÖ **XSS Prevention**: HTML escaping + CSP headers
   ‚úÖ **API Key Security**: Backend-only (never exposed to frontend)

   ## Development

   ### Scripts
   ```bash
   npm start      # Production server
   npm run dev    # Development with auto-reload
   npm run seed   # Seed database with initial data
   ```

   ### Environment Variables
   See `.env.example` for complete list with descriptions.

   **Required**:
   - `DATABASE_URL` - PostgreSQL connection string
   - `ANTHROPIC_API_KEY` - Claude AI API key
   - `ALCHEMY_API_KEY` - Base network RPC
   - `REPLICATE_API_TOKEN` - Image generation API

   **Optional**:
   - `PORT` - Server port (default: 7378)
   - `NODE_ENV` - Environment (development/production)
   - `LOG_LEVEL` - Log level (error/warn/info/debug)

   ### Project Structure
   ```
   agent-economy-hub/
   ‚îú‚îÄ‚îÄ src/
   ‚îÇ   ‚îú‚îÄ‚îÄ index.js        # Express server + routes
   ‚îÇ   ‚îú‚îÄ‚îÄ hub.js          # Hub web UI routes
   ‚îÇ   ‚îú‚îÄ‚îÄ db.js           # Database functions
   ‚îÇ   ‚îú‚îÄ‚îÄ ai.js           # Claude AI integration
   ‚îÇ   ‚îú‚îÄ‚îÄ replicate.js    # Image generation
   ‚îÇ   ‚îú‚îÄ‚îÄ blockchain.js   # Payment verification
   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks.js     # Agent webhook delivery
   ‚îÇ   ‚îú‚îÄ‚îÄ validation.js   # Input validation (Zod)
   ‚îÇ   ‚îú‚îÄ‚îÄ services.js     # Service definitions
   ‚îÇ   ‚îú‚îÄ‚îÄ logger.js       # Winston logging
   ‚îÇ   ‚îî‚îÄ‚îÄ stats.js        # Operational metrics
   ‚îú‚îÄ‚îÄ scripts/
   ‚îÇ   ‚îú‚îÄ‚îÄ seed.js         # Database seeding
   ‚îÇ   ‚îî‚îÄ‚îÄ README.md       # Scripts documentation
   ‚îú‚îÄ‚îÄ docs/
   ‚îÇ   ‚îî‚îÄ‚îÄ RAILWAY.md      # Deployment guide
   ‚îú‚îÄ‚îÄ .planning/          # Development roadmap
   ‚îî‚îÄ‚îÄ railway.json        # Railway configuration
   ```

   ## Roadmap

   **Completed** (Phases 1-10):
   - ‚úÖ Environment setup and dependencies
   - ‚úÖ Payment verification and security
   - ‚úÖ AI processing integration
   - ‚úÖ Image generation (Replicate)
   - ‚úÖ Results display and formatting
   - ‚úÖ Agent webhook system
   - ‚úÖ Input validation and error handling
   - ‚úÖ Mobile responsive UI
   - ‚úÖ Rate limiting and ops monitoring
   - ‚úÖ Database seeding script

   **In Progress** (Phase 11):
   - üî® Railway deployment configuration

   **Planned** (Phases 12-13):
   - üìã End-to-end testing
   - üìã Launch preparation

   See `.planning/ROADMAP.md` for detailed phase breakdown.

   ## Contributing

   This is a personal project for learning and experimentation. Not currently accepting contributions.

   ## License

   MIT

   ---

   **Built by DigiJerry** ¬∑ **Powered by Claude Code** ¬∑ **Deployed on Railway**
   ```

**Files Modified**:
- `README.md` (completely rewritten to reflect Agent Economy Hub)

**Verification**:
- Reflects Agent Economy Hub (not just MrMagoochi)
- Lists all 22 services across 6 categories
- Documents API endpoints
- Includes architecture overview
- Links to Railway deployment guide
- Shows current tech stack

**Commit Message**:
```
docs(11-01): update README.md to reflect Agent Economy Hub functionality
```

---

## Task 4: Verify and Optimize railway.json Configuration

**Goal**: Ensure railway.json has optimal production settings

**What to do**:

1. **Review current railway.json** (already optimal, but document why):
   - ‚úÖ Builder: NIXPACKS (automatic, no changes needed)
   - ‚úÖ Start command: "node src/index.js" (correct)
   - ‚úÖ Health check: "/health" (implemented in Phase 9)
   - ‚úÖ Restart policy: ON_FAILURE (appropriate for our app)
   - ‚úÖ Max retries: 3 (reasonable limit)

2. **Add railway.json documentation** as inline comment:

   Since JSON doesn't support comments, create `docs/RAILWAY-CONFIG.md`:
   ```markdown
   # Railway Configuration Explained

   ## railway.json

   ```json
   {
     "$schema": "https://railway.app/railway.schema.json",
     "build": {
       "builder": "NIXPACKS"
     },
     "deploy": {
       "startCommand": "node src/index.js",
       "healthcheckPath": "/health",
       "restartPolicyType": "ON_FAILURE",
       "restartPolicyMaxRetries": 3
     }
   }
   ```

   ### Configuration Details

   **Builder: NIXPACKS**
   - Automatic Node.js detection via package.json
   - Installs dependencies with `npm install`
   - No custom build steps needed
   - Alternative: DOCKERFILE (if you need custom build)

   **Start Command: node src/index.js**
   - Runs the Express server
   - Matches package.json "start" script
   - No process manager needed (Railway handles restarts)

   **Health Check Path: /health**
   - Railway polls this endpoint every 60 seconds
   - Endpoint must return 200 for healthy status
   - Returns 503 if database connection fails
   - See Phase 9 documentation for implementation details

   **Restart Policy: ON_FAILURE**
   - Restarts app if it crashes or becomes unhealthy
   - Max retries: 3 attempts
   - After 3 failed restarts, app stays down (manual intervention needed)
   - Alternative: ALWAYS (restarts even on clean exit, not recommended)

   ### Why These Settings Work

   1. **NIXPACKS**: Detects Node.js automatically, no config needed
   2. **Health Check**: Our /health endpoint tests DB connection and returns proper status codes
   3. **Restart Policy**: ON_FAILURE prevents infinite restart loops while recovering from transient issues
   4. **Max Retries: 3**: Balances automatic recovery with preventing runaway restarts

   ### When to Modify

   **Change builder to DOCKERFILE if**:
   - Need custom system dependencies (e.g., ImageMagick, FFmpeg)
   - Need multi-stage builds
   - Need specific Node.js version not detected by Nixpacks

   **Change health check path if**:
   - Using different endpoint for health checks
   - Need custom health check logic

   **Change restart policy to ALWAYS if**:
   - App intentionally exits and should always restart
   - Not recommended for our use case

   **Increase max retries if**:
   - Database connections are slow to establish
   - External service dependencies are unreliable
   - Current setting (3) is usually sufficient

   ---

   ## Optional: Environment-Specific Configuration

   Railway doesn't support multiple railway.json files, but you can use environment variables:

   ```javascript
   // In src/index.js (already implemented)
   const PORT = process.env.PORT || 7378;
   const NODE_ENV = process.env.NODE_ENV || 'development';
   ```

   Set these in Railway dashboard ‚Üí Variables:
   - NODE_ENV=production
   - LOG_LEVEL=info (or warn for less verbose logging)
   ```

**Files Modified**:
- `docs/RAILWAY-CONFIG.md` (created - explains railway.json settings)
- `railway.json` (no changes needed - already optimal)

**Verification**:
- railway.json configuration explained
- All settings justified
- Guidance for when to modify settings

**Commit Message**:
```
docs(11-01): document railway.json configuration and settings
```

---

## Task 5: Create Production Deployment Checklist

**Goal**: Create a checklist for production deployment and verification

**What to do**:

1. **Create docs/PRODUCTION-CHECKLIST.md**:
   ```markdown
   # Production Deployment Checklist

   Complete checklist for deploying Agent Economy Hub to production on Railway.

   ## Pre-Deployment

   ### Code Readiness
   - [ ] All phases complete (Phase 1-11 ‚úÖ)
   - [ ] Main branch is stable (no failing tests)
   - [ ] No console.log statements (use Winston logger)
   - [ ] No hardcoded secrets (all in environment variables)
   - [ ] .env file in .gitignore (verify: `git check-ignore .env`)

   ### API Keys Ready
   - [ ] Anthropic API key obtained (https://console.anthropic.com/)
   - [ ] Alchemy API key obtained (https://alchemy.com/, Base network)
   - [ ] Replicate API token obtained (https://replicate.com/account/api-tokens)
   - [ ] Keys tested locally (npm run dev works with all services)

   ### Documentation
   - [ ] README.md up to date
   - [ ] .env.example complete with all variables
   - [ ] docs/RAILWAY.md deployment guide exists
   - [ ] scripts/README.md seed documentation exists

   ## Railway Setup

   ### Project Creation
   - [ ] Railway account created
   - [ ] Project created from GitHub repo
   - [ ] Repository connected (automatic deploys enabled)

   ### Database
   - [ ] PostgreSQL add-on attached
   - [ ] DATABASE_URL automatically set
   - [ ] Database accessible from Railway app

   ### Environment Variables
   - [ ] ANTHROPIC_API_KEY set
   - [ ] ALCHEMY_API_KEY set
   - [ ] REPLICATE_API_TOKEN set
   - [ ] NODE_ENV=production set
   - [ ] LOG_LEVEL=info set (optional)
   - [ ] PORT not manually set (Railway sets automatically)
   - [ ] DATABASE_URL not manually set (PostgreSQL add-on sets automatically)

   ### Configuration
   - [ ] railway.json exists and is correct
   - [ ] Health check path: /health
   - [ ] Start command: node src/index.js
   - [ ] Restart policy: ON_FAILURE, max 3 retries

   ## Deployment

   ### Initial Deploy
   - [ ] Push to main branch triggers deploy
   - [ ] Build succeeds (check Railway logs)
   - [ ] App starts successfully (check "Service" status)
   - [ ] No startup errors in logs

   ### Database Seeding
   - [ ] Run seed script: `railway run npm run seed`
   - [ ] OR create temporary seed service (see docs/RAILWAY.md Step 5)
   - [ ] Verify seed logs: "MrMagoochi user created"
   - [ ] Verify seed logs: "MrMagoochi agent created"
   - [ ] Verify seed logs: "Skills seeding complete: created: 22"

   ### Health Check
   - [ ] Health endpoint accessible
   - [ ] Command: `curl https://your-app.up.railway.app/health`
   - [ ] Response: 200 OK
   - [ ] Response includes: status: "healthy"
   - [ ] Response includes: database: "connected"
   - [ ] Railway dashboard shows "Healthy" status

   ## Post-Deployment Verification

   ### Functional Testing

   #### Web Pages
   - [ ] Landing page loads: GET /
   - [ ] Agents page loads: GET /agents
   - [ ] Shows MrMagoochi agent
   - [ ] Agent detail page loads: GET /agent/1
   - [ ] Shows 22 skills
   - [ ] Dashboard loads: GET /dashboard

   #### API Endpoints
   - [ ] Health check: GET /health returns 200
   - [ ] Readiness check: GET /ready returns 200
   - [ ] Stats endpoint: GET /api/stats returns system metrics
   - [ ] Services list: GET /api/services returns 22 services
   - [ ] Agents list: GET /api/agents returns MrMagoochi

   #### End-to-End Flow (Manual Test)
   1. [ ] Create job: POST /api/jobs
   2. [ ] Send USDC payment on Base network
   3. [ ] Verify payment: POST /api/jobs/:uuid/pay
   4. [ ] Check job status: GET /api/jobs/:uuid
   5. [ ] Verify results appear in job output

   ### Performance

   #### Response Times
   - [ ] Health check responds in <500ms
   - [ ] Landing page loads in <2s
   - [ ] Agent detail page loads in <2s
   - [ ] Dashboard loads in <2s

   #### Rate Limiting
   - [ ] Payment endpoint: 5 req/min limit enforced
   - [ ] Job creation: 10 req/min limit enforced
   - [ ] Rate limit headers present (RateLimit-Limit, RateLimit-Remaining)

   ### Monitoring

   #### Logs
   - [ ] Logs visible in Railway dashboard
   - [ ] Structured JSON format (Winston)
   - [ ] No error-level logs during normal operation
   - [ ] Request logs include method, path, status, duration

   #### Metrics
   - [ ] /api/stats returns request counts
   - [ ] /api/stats returns uptime
   - [ ] /api/stats returns memory usage

   ### Security

   #### Environment Variables
   - [ ] No secrets in git repository
   - [ ] .env not committed (check: `git log --all -- .env`)
   - [ ] All API keys set via Railway Variables (not in code)

   #### Headers and Policies
   - [ ] CSP header present (check browser dev tools)
   - [ ] Rate limiting active (test with multiple requests)
   - [ ] HTTPS enabled (Railway automatic)

   #### Input Validation
   - [ ] Test invalid inputs return 400 errors
   - [ ] Test SQL injection attempts are blocked
   - [ ] Test XSS attempts are escaped

   ## Optional: Custom Domain

   ### DNS Configuration
   - [ ] CNAME record added to DNS
   - [ ] Host: your-subdomain
   - [ ] Value: your-app.up.railway.app
   - [ ] TTL: 3600

   ### Railway Configuration
   - [ ] Custom domain added in Railway Settings ‚Üí Domains
   - [ ] DNS verification complete (Railway checks CNAME)
   - [ ] SSL certificate provisioned (automatic)
   - [ ] HTTPS redirect enabled (automatic)

   ### Verification
   - [ ] Custom domain resolves: `nslookup your-domain.com`
   - [ ] HTTPS works: https://your-domain.com/health
   - [ ] SSL certificate valid (check browser lock icon)

   ## Launch Readiness

   ### Final Checks
   - [ ] All checklist items above completed
   - [ ] Production URL shared with team
   - [ ] Monitoring alerts configured (optional)
   - [ ] Backup strategy documented (Railway auto-backups)
   - [ ] Rollback plan ready (Railway: redeploy previous version)

   ### Communication
   - [ ] Announce launch URL to stakeholders
   - [ ] Document any known issues or limitations
   - [ ] Share API documentation (README.md)
   - [ ] Provide support contact information

   ## Post-Launch Monitoring (First 24 Hours)

   - [ ] Check logs every hour for errors
   - [ ] Monitor health check status
   - [ ] Watch for rate limit hits (might need adjustment)
   - [ ] Track API costs (Anthropic, Replicate, Alchemy)
   - [ ] Verify payment flow works end-to-end
   - [ ] Monitor database connection pool usage

   ## Rollback Procedure (If Needed)

   1. Go to Railway project ‚Üí Deployments
   2. Find previous successful deployment
   3. Click "Redeploy" on that version
   4. Monitor logs to ensure successful rollback
   5. Verify health check returns to normal
   6. Investigate issue in separate branch

   ---

   **Last Updated**: 2026-02-03
   **Version**: 0.9.0
   **Target Environment**: Railway Production
   ```

**Files Modified**:
- `docs/PRODUCTION-CHECKLIST.md` (created - comprehensive deployment checklist)

**Verification**:
- All deployment steps included
- Pre-deployment, deployment, and post-deployment sections
- Functional testing checklist
- Security verification steps
- Rollback procedure documented

**Commit Message**:
```
docs(11-01): create production deployment checklist
```

---

## Task 6: Add Deployment Quick Reference

**Goal**: Create a single-page quick reference for common deployment tasks

**What to do**:

1. **Create docs/QUICK-REFERENCE.md**:
   ```markdown
   # Railway Quick Reference

   One-page reference for common Railway deployment tasks.

   ## URLs

   - **Railway Dashboard**: https://railway.app/
   - **Project URL**: https://your-app.up.railway.app
   - **Health Check**: https://your-app.up.railway.app/health
   - **API Stats**: https://your-app.up.railway.app/api/stats

   ## Environment Variables (Required)

   | Variable | Example | Where to Get |
   |----------|---------|--------------|
   | ANTHROPIC_API_KEY | sk-ant-... | https://console.anthropic.com/ |
   | ALCHEMY_API_KEY | abc123... | https://alchemy.com/ (Base network) |
   | REPLICATE_API_TOKEN | r8_... | https://replicate.com/account/api-tokens |
   | NODE_ENV | production | Manual: Type "production" |

   **Auto-Set** (don't set manually):
   - DATABASE_URL (from PostgreSQL add-on)
   - PORT (from Railway)

   ## Common Commands

   ### Railway CLI

   ```bash
   # Install
   npm install -g @railway/cli

   # Login
   railway login

   # Link project
   railway link

   # View logs
   railway logs

   # Run seed script
   railway run npm run seed

   # Restart service
   railway restart

   # Open dashboard
   railway open
   ```

   ### Manual Deployment

   ```bash
   # Push to main branch
   git push origin main

   # Railway auto-deploys on push
   ```

   ## Quick Health Check

   ```bash
   # Check if app is healthy
   curl https://your-app.up.railway.app/health

   # Expected: {"status":"healthy","database":"connected",...}
   ```

   ## Troubleshooting (5-Minute Debug)

   ### App Won't Start

   1. **Check logs**: Railway ‚Üí Deployments ‚Üí View Logs
   2. **Common issues**:
      - Missing env var: "Missing required environment variables: [...]"
      - DB not connected: Add PostgreSQL add-on
      - Build failed: Check package.json dependencies

   ### Health Check Fails (503)

   1. **Test manually**: `curl https://your-app.up.railway.app/health`
   2. **If timeout**: App crashed, check logs
   3. **If "database: disconnected"**: Check PostgreSQL add-on

   ### Rate Limited (429)

   - **Normal behavior**: Rate limits are working
   - **Limits**: Payment (5/min), Job creation (10/min), Reads (100/min)
   - **Fix**: Wait 60 seconds or increase limits in code

   ## Deployment Steps (60 Seconds)

   1. Create Railway project from GitHub
   2. Add PostgreSQL database
   3. Set 4 environment variables (see table above)
   4. Deploy automatically happens
   5. Run: `railway run npm run seed`
   6. Verify: `curl https://your-app.up.railway.app/health`

   ‚úÖ Done!

   ## Monitoring

   **Health**: Railway auto-monitors `/health` every 60s
   **Logs**: Railway dashboard ‚Üí Deployments ‚Üí View Logs
   **Metrics**: https://your-app.up.railway.app/api/stats

   ## Useful Links

   - [Full Deployment Guide](RAILWAY.md)
   - [Production Checklist](PRODUCTION-CHECKLIST.md)
   - [Railway Docs](https://docs.railway.app/)
   - [Project README](../README.md)

   ---

   *For detailed instructions, see [RAILWAY.md](RAILWAY.md)*
   ```

**Files Modified**:
- `docs/QUICK-REFERENCE.md` (created - one-page reference)

**Verification**:
- Single-page format (can print/bookmark)
- Essential information only
- Quick troubleshooting guide
- All common commands included

**Commit Message**:
```
docs(11-01): add Railway quick reference guide
```

---

## Verification

**After All Tasks Complete**:

1. **Documentation exists**:
   ```bash
   ls -l docs/
   # Should show:
   # - RAILWAY.md (deployment guide)
   # - RAILWAY-CONFIG.md (config explanation)
   # - PRODUCTION-CHECKLIST.md (deployment checklist)
   # - QUICK-REFERENCE.md (one-page reference)
   ```

2. **.env.example is complete**:
   ```bash
   cat .env.example | grep -E "DATABASE_URL|ANTHROPIC_API_KEY|ALCHEMY_API_KEY|REPLICATE_API_TOKEN|NODE_ENV|LOG_LEVEL"
   ```
   All 6 variables should be present with descriptions

3. **README.md is updated**:
   ```bash
   grep "Agent Economy Hub" README.md
   grep "22 services" README.md
   ```
   Should reflect current project state

4. **railway.json is optimal**:
   ```bash
   cat railway.json | jq '.deploy.healthcheckPath'
   # Should output: "/health"
   ```

**Success Criteria**:
- ‚úÖ .env.example complete with all required and optional variables
- ‚úÖ docs/RAILWAY.md created (comprehensive deployment guide)
- ‚úÖ docs/RAILWAY-CONFIG.md created (railway.json explanation)
- ‚úÖ docs/PRODUCTION-CHECKLIST.md created (deployment checklist)
- ‚úÖ docs/QUICK-REFERENCE.md created (one-page reference)
- ‚úÖ README.md updated to reflect Agent Economy Hub
- ‚úÖ railway.json verified (already optimal)
- ‚úÖ All changes committed with proper commit messages

---

## Success Criteria

- [ ] .env.example updated with complete configuration
- [ ] DATABASE_URL documented in .env.example
- [ ] ALCHEMY_API_KEY documented in .env.example
- [ ] All optional variables documented (PORT, NODE_ENV, LOG_LEVEL)
- [ ] docs/RAILWAY.md created (deployment guide)
- [ ] docs/RAILWAY-CONFIG.md created (config explanation)
- [ ] docs/PRODUCTION-CHECKLIST.md created (deployment checklist)
- [ ] docs/QUICK-REFERENCE.md created (quick reference)
- [ ] README.md updated to reflect Agent Economy Hub
- [ ] Lists all 22 services
- [ ] Documents current architecture
- [ ] Links to deployment guides
- [ ] railway.json verified and documented
- [ ] All changes committed with proper commit messages

---

## Output

**Files Created**:
- `docs/RAILWAY.md` (~500 lines) - Comprehensive deployment guide
- `docs/RAILWAY-CONFIG.md` (~100 lines) - Configuration explanation
- `docs/PRODUCTION-CHECKLIST.md` (~250 lines) - Deployment checklist
- `docs/QUICK-REFERENCE.md` (~100 lines) - Quick reference

**Files Modified**:
- `.env.example` (~80 lines) - Complete environment configuration
- `README.md` (~300 lines) - Updated to reflect Agent Economy Hub

**Total Lines Added**: ~1,330 lines (documentation)

**Code Changes**: None (documentation only)

**Estimated Complexity**: Low (documentation and configuration)

**Estimated Time**: ~1 hour

---

*Plan created: 2026-02-03 for Phase 11: Railway Deployment Configuration*
